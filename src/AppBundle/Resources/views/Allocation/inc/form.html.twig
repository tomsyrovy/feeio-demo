{% form_theme form 'bootstrap_3_layout.html.twig' %}

{% set colspan = 19 %}

{% macro widget_prototype2(widget, colspan) %}

    {% if widget.vars.prototype is defined %}
        {% set form = widget.vars.prototype %}
        {% set externalSource = widget.vars.prototype.externalSource %}
        {% set generalSource = widget.vars.prototype.generalSource %}
        {% set concreteSource = widget.vars.prototype.concreteSource %}
        {% set generalSourceExt = widget.vars.prototype.generalSourceExt %}
        {% set concreteSourceExt = widget.vars.prototype.concreteSourceExt %}
        {% set unit = widget.vars.prototype.unit %}
        {% set quantityPlan = widget.vars.prototype.quantityPlan %}
        {% set buyingPricePlan = widget.vars.prototype.buyingPricePlan %}
        {% set sellingPricePlan = widget.vars.prototype.sellingPricePlan %}
        {% set quantityReal = widget.vars.prototype.quantityReal %}
        {% set buyingPriceReal = widget.vars.prototype.buyingPriceReal %}
        {% set sellingPriceReal = widget.vars.prototype.sellingPriceReal %}
        {% set name = widget.vars.prototype.vars.full_name %}
    {% else %}
        {% set form = widget %}
        {% set externalSource = widget.externalSource %}
        {% set generalSource = widget.generalSource %}
        {% set concreteSource = widget.concreteSource %}
        {% set generalSourceExt = widget.generalSourceExt %}
        {% set concreteSourceExt = widget.concreteSourceExt %}
        {% set unit = widget.unit %}
        {% set quantityPlan = widget.quantityPlan %}
        {% set buyingPricePlan = widget.buyingPricePlan %}
        {% set sellingPricePlan = widget.sellingPricePlan %}
        {% set quantityReal = widget.quantityReal %}
        {% set buyingPriceReal = widget.buyingPriceReal %}
        {% set sellingPriceReal = widget.sellingPriceReal %}
        {% set name = widget.vars.full_name %}
    {% endif %}

    <tr data-content="{{ name }}" class="row-item">
        <td class="cell-externalSource">
            {{ form_widget(externalSource) }}
        </td>
        <td class="cell-generalSource">
            {{ form_widget(generalSource) }}
        </td>
        <td class="cell-concreteSource">
            {{ form_widget(concreteSource) }}
        </td>
        <td class="cell-generalSourceExt">
            {{ form_widget(generalSourceExt) }}
        </td>
        <td class="cell-concreteSourceExt">
            {{ form_widget(concreteSourceExt) }}
        </td>
        <td class="cell-unit">
            {{ form_widget(unit) }}
        </td>
        <td class="cell-quantityPlan">
            {{ form_widget(quantityPlan) }}
        </td>
        <td class="cell-buyingPricePlan">
            {{ form_widget(buyingPricePlan) }}
        </td>
        <td class="cell-marginPlan">
            <input type="text" class="form-control">
        </td>
        <td class="cell-sellingPricePlan">
            {{ form_widget(sellingPricePlan) }}
        </td>
        <td class="cell-sumBuyingPricePlan">
            <input type="text" class="form-control" readonly="readonly">
        </td>
        <td class="cell-sumSellingPricePlan">
            <input type="text" class="form-control" readonly="readonly">
        </td>
        <td class="cell-sumProfitPlan">
            <input type="text" class="form-control" readonly="readonly">
        </td>
        <td class="cell-quantityReal">
            {{ form_widget(quantityReal) }}
        </td>
        <td class="cell-buyingPriceReal">
            {{ form_widget(buyingPriceReal) }}
        </td>
        <td class="cell-marginReal">
            <input type="text" class="form-control">
        </td>
        <td class="cell-sellingPriceReal">
            {{ form_widget(sellingPriceReal) }}
        </td>
        <td class="cell-sumBuyingPriceReal">
            <input type="text" class="form-control" readonly="readonly">
        </td>
        <td class="cell-sumSellingPriceReal">
            <input type="text" class="form-control" readonly="readonly">
        </td>
        <td class="cell-sumProfitReal">
            <input type="text" class="form-control" readonly="readonly">
        </td>

        <td class="text-right">
            <a href="#" style='margin-left: 5px' class="btn btn-xs btn-danger btn-remove" data-related="{{ name }}">
                <i class="fa fa-trash"></i>
            </a>
        </td>
    </tr>

{% endmacro %}

{% macro widget_prototype(widget, colspan) %}

    {% if widget.vars.prototype is defined %}
        {% set form = widget.vars.prototype %}
        {% set n = widget.vars.prototype.name %}
        {% set name = widget.vars.prototype.vars.name %}
    {% else %}
        {% set form = widget %}
        {% set n = widget.name %}
        {% set name = widget.vars.name %}
    {% endif %}

    <tbody class="top-content" data-content="{{ name }}">
        <tr>
            <td colspan="{{ (colspan-2) }}">
                {{ form_row(n) }}
            </td>
            <td colspan="3" class="text-right">
                <a href="#" class="btn btn-danger btn-remove" data-related="{{ name }}">
                    <i class="fa fa-trash"></i>
                </a>
            </td>
        </tr>
    </tbody>
    <tbody class="middle-label" data-content="{{ name }}">
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>&sum;</td>
            <td>&sum;</td>
            <td>&sum;</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>&sum;</td>
            <td>&sum;</td>
            <td>&sum;</td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td>Položka</td>
            <td>Dodavatel</td>
            <td>Jednotka</td>
            <td>Množství</td>
            <td>Nákupní cena</td>
            <td>Marže</td>
            <td>Prodejní cena</td>
            <td>Nákupní cena</td>
            <td>Prodejní cena</td>
            <td>Zisk</td>
            <td>Množství</td>
            <td>Nákupní cena</td>
            <td>Marže</td>
            <td>Prodejní cena</td>
            <td>Nákupní cena</td>
            <td>Prodejní cena</td>
            <td>Zisk</td>
            <td></td>
        </tr>
        <tr class="type">
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>plán</td>
            <td>plán</td>
            <td>plán</td>
            <td>plán</td>
            <td>plán</td>
            <td>plán</td>
            <td>plán</td>
            <td>reál</td>
            <td>reál</td>
            <td>reál</td>
            <td>reál</td>
            <td>reál</td>
            <td>reál</td>
            <td>reál</td>
            <td></td>
        </tr>
    </tbody>

    <tbody class='middle-content' id="allocationContainerListItems_{{ name }}" data-prototype="{{ _self.widget_prototype2(form.allocationContainerListItems, colspan)|escape }}" data-content="{{ name }}">
        {% for allocationContainerListItem in form.allocationContainerListItems %}
            {{ _self.widget_prototype2(allocationContainerListItem, colspan) }}
        {% endfor %}
    </tbody>

    <tbody class="sep" data-content="{{ name }}">
        <tr>
            <td colspan="{{ colspan }}">
                <a href="#" class="btn btn-xs btn-default btn-add" data-target="allocationContainerListItems_{{ name }}" data-regex="__name2__"><i class="fa fa-plus"></i> nová položka</a>
            </td>
        </tr>
    </tbody>

    <tbody class='low-content' data-content="{{ name }}" data-total="allocationContainerListItems_{{ name }}">
        <tr class="total">
            <td colspan="3">mezisoučet</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="cell-sumBuyingPricePlan">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td class="cell-sumSellingPricePlan">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td class="cell-sumProfitPlan">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td class="cell-sumBuyingPriceReal">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td class="cell-sumSellingPriceReal">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td class="cell-sumProfitReal">
                <input type="text" class="form-control" readonly="readonly">
            </td>
            <td></td>
        </tr>
    </tbody>

{% endmacro %}

<style>
    .table-form {
        width: 100%;
        margin-bottom: 30px;
    }
    .table-form td {
        padding: 0 1px 0 0;
        vertical-align: top;
    }
    .table-form td input, .table-form td select {
        width: 100%;
        height: auto;
        border: solid 1px #ecf0f1;
        border-radius: 4px;
        padding: 3px 4px;
    }
    .table-form td select {
        padding: 1px 4px;
    }
    .table-form .top-content td {
        font-size: inherit;
        vertical-align: middle;
    }
    .table-form .top-content input, .table-form .top-content select {
        font-size: inherit;
    }
    .table-form .middle-label td {
        text-align: center;
        font-weight: bold;
        font-size: 12px;
    }
    .table-form .middle-label .type td {
        font-weight: normal;
        font-size: 11px;
    }
    .table-form .middle-content input, .table-form .low-content input, .table-form .middle-content select, .table-form .low-content select {
        font-size: 11px;
    }
    .table-form .total {
        border-top: 1px solid #000;
    }
    .table-form .total td {
        font-weight: bold;
    }
    .table-form .low-content td {
        padding-top: 3px;
        padding-bottom: 40px;
    }
    .table-form .sep td {
        padding-bottom: 3px;
    }
    .table-form .grand-total {
        border-top: 3px solid #000;
    }
    .table-form .grand-total td {
        font-weight: bold;
        font-size: 16px;
        padding-top: 3px;
    }
</style>

<div class="col-lg-12">

    {{ form_errors(form) }}

    <div class="panel panel-default">
        <div class="panel-body">

            {{ form_start(form, {'attr' : {'id' : 'form'}}) }} <!-- začne formulář -->

            {#<div class="row">#}
                {#<div class="col-lg-12">#}
                    {#{{ form_row(form.yearmonth) }}#}
                {#</div>#}
            {#</div>#}

            <div class="row">
                <div class="col-lg-12">
                    <table class="table-form" id="allocationContainerLists" data-prototype="{{ _self.widget_prototype(form.allocationContainerLists, colspan)|escape }}">
                        {% for allocationContainerList in form.allocationContainerLists %}

                            {{ _self.widget_prototype(allocationContainerList, colspan) }}

                        {% endfor %}
                        <tfoot>
                            <tr class="sep">
                                <td colspan="{{ colspan }}">
                                    <a href="#" class="btn btn-default btn-add" data-target="allocationContainerLists" data-regex="__name__"><i class="fa fa-plus"></i> nový seznam položek</a>
                                </td>
                            </tr>
                            <tr class="grand-total">
                                <td colspan="3">SOUČET</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="cell-sumBuyingPricePlan">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td class="cell-sumSellingPricePlan">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td class="cell-sumProfitPlan">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="cell-sumBuyingPriceReal">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td class="cell-sumSellingPriceReal">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td class="cell-sumProfitReal">
                                    <input type="text" class="form-control" readonly="readonly">
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="text-center">
                <input class="btn btn-primary" type="submit" value="{{ submitLabel }}">
                <!-- mezi začátek a konec je možné vkládat vlastní formulářové prvky, ale pokud nejsou vloženy i na backendu, tak nebudou zpracovány -->
            </div>

            {{ form_widget(form._token) }}

            {{ form_end(form, {'render_rest': false}) }} <!-- skončí formulář (dovykreslí nevykreslené prvky formuláře a poté ukončovací značku) -->

            <!-- a takto to je všechno - určitě budeš potřebovat vědět, jaké jsou názvy (name) prvků ve formuláři - tyto names zjistíš tak, že si dáš vykreslit celý formulář a v kodu v prohližeči to najdeš, nebo si otevřeš soubor, který definuje formulář (resp. formulářový typ: src/AppBundle/Form/Type/ContactFormType.php) -->


        </div> <!-- .panel-body -->
    </div> <!-- .panel -->

</div> <!-- .col-lg-6 -->